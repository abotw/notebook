# DMA方式的传送过程

---

## 一、基本概念

**DMA（Direct Memory Access，直接存储器访问）**  
是指由 **DMA控制器（DMAC, DMA Controller）** 直接控制外设与内存之间的数据传送，**无需 CPU 参与传送过程**，仅在开始与结束时由 CPU 控制，极大提升了 I/O 效率。

---

## 二、DMA传送的基本步骤

DMA传送过程通常包含以下四个阶段：

1. **CPU 初始化阶段**
    
    - CPU 配置 DMA 控制器，包括：
        
        - 外设地址
            
        - 内存地址
            
        - 数据块大小
            
        - 传送方式（如周期窃取、突发传送等）
            
    - CPU 发出“DMA请求允许”信号，DMA 准备工作完成。
        
2. **DMA请求阶段（DMA Request, DRQ）**
    
    - 外设准备好数据后，向 DMA 控制器发送请求信号 `DRQ`（DMA Request）。
        
3. **DMA传送阶段（DMA Transfer）**
    
    - DMAC 发出总线请求 `HRQ`（Hold Request），请求总线控制权；
        
    - CPU 响应 `HLDA`（Hold Acknowledge）信号，将总线控制权让出；
        
    - DMAC 开始进行数据传送：
        
        - 外设 → 内存（输入设备）
            
        - 内存 → 外设（输出设备）
            
4. **传送完成阶段**
    
    - DMAC 完成预设字节数传输后，产生中断 `INT` 通知 CPU；
        
    - CPU 响应中断，进行后续处理。
        

---

## 三、DMA传送方式对比（横向理解）

|方式名称|是否占用总线|是否暂停CPU|特点与适用场景|
|---|---|---|---|
|周期窃取方式（Cycle Stealing）|✅ 是|✅ 是|每次传送 1 字节，CPU 被打断|
|突发传送方式（Block Transfer）|✅ 是|✅ 是|一次传送完整数据块，效率高|
|透明传送方式（Transparent DMA）|❌ 否|❌ 否|仅在 CPU 不使用总线时传送，效率低但不影响CPU|

---

## 四、示意图（逻辑关系图）

```
外设 ─┬──> DRQ ──> DMA 控制器 ──> HRQ ──> CPU
      │                                ↓
      └<── DACK <────<──── HLDA <──────┘

DMA 控制器 ←→ 内存 ←→ 数据总线
```

---

## 五、典型例题（考研408风格）

> **例题**：下列有关 DMA 工作过程的说法中，正确的是：  
> A. CPU 全程控制数据传送过程  
> B. DMA 控制器和 CPU 同时访问总线  
> C. DMA 工作中，CPU 必须暂停使用总线  
> D. DMA 不需要 CPU 参与

**答案：C**

**解析：**  
DMA 传送过程中，**DMA 控制器需获得总线控制权**，因此 CPU 必须暂时让出总线。

---

## 六、相关扩展与联系

- **与中断方式对比：**  
    中断方式依赖 CPU 响应中断并传送数据，适用于少量数据；DMA 适用于大量数据传输，CPU 可并行处理其他任务。
    
- **与总线结构关联：**  
    DMA 方式对系统总线的设计和调度有影响，高性能系统可能使用多总线结构以减少冲突。
    
- **与嵌入式/操作系统联系：**  
    在 Linux 驱动或嵌入式系统开发中，DMA 控制器（如 ARM SoC 中的 DMA Channel）是关键资源。
    

---

## 七、速查总结

- ✅ 需 CPU 配置，非全自动
    
- ✅ 请求-应答机制（DRQ/HRQ-HLDA）
    
- ✅ 可减少 CPU 负担，提高 I/O 效率
    
- ✅ 常与周期窃取方式配合使用
    
- ✅ 传输结束需中断 CPU，完成后续处理
    