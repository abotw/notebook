---
aliases:
  - file
---

## `file` 结构（打开文件描述符）

**定义**  
在 Linux 内核中，`file` 结构表示一个**已经打开的文件**，对应于用户空间中的一个**文件描述符（fd）**。

---

### 🧩 关系图简化

```
进程 --> 文件描述符表 --> file结构 --> inode
```

---

### 📄 `file` 结构包含的信息

- 当前文件的读/写**偏移量**（文件指针）
    
- 对应的 **inode 指针**
    
- 访问模式（只读、只写、读写等）
    
- 引用计数（多个描述符可以共享一个 `file`）
    
- 指向内核缓存或缓冲区的指针（如管道缓冲区）
    

---

### 📎 与用户程序的关系

- 程序调用 `open()` 时，内核会创建一个 `file` 结构；
    
- 程序获取的是一个**文件描述符（int）**，它只是 `file` 结构的索引；
    
- 不同进程可以通过文件描述符表映射到相同的 `file` 结构，从而共享同一个文件状态。
    

---

### 🔁 在管道中的作用

- 创建匿名管道时，系统会分配两个 `file` 结构：
    
    - 一个只读，给读端进程；
        
    - 一个只写，给写端进程；
        
- 它们都指向同一个 inode，从而共享同一块缓冲区。
    

---

### 📝 小结

- `file` 是“打开文件”的内核对象；
    
- 包含文件状态、位置、权限等运行时信息；
    
- 是连接用户态文件描述符和内核态 inode 的桥梁。
