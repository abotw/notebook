
# 信号量

## 概念简述

- **信号量（Semaphore）**：一种用于**进程/线程同步与互斥**的机制。
    
- **本质**：是一个整型计数器，结合原子操作和等待机制使用。
    
- **分类**：
    
    - **计数信号量**（Counting Semaphore）：可取任意非负值，用于**资源数量控制**。
        
    - **二进制信号量**（Binary Semaphore / Mutex）：取值为0或1，常用于**互斥访问临界区**。
        

## 基本操作

1. **P（wait/down）操作**：
    
    - 如果信号量 > 0，则减1，进程继续；
        
    - 否则阻塞等待。
        
2. **V（signal/up）操作**：
    
    - 将信号量加1；
        
    - 若有等待进程，唤醒其中一个。
        

> P/V 操作需要原子性，防止竞态条件。

## 典型应用场景与案例

### 1. **互斥（Mutual Exclusion）**

- 保护临界区，只允许一个线程访问。
    
- **例**：打印机资源保护——多个用户不能同时访问打印队列。
    

### 2. **同步（Synchronization）**

- 强制执行顺序。
    
- **例**：生产者-消费者问题：
    
    - **空位信号量**：控制生产者；
        
    - **产品信号量**：控制消费者；
        
    - **互斥信号量**：保护缓冲区访问。
        

### 3. **经典案例：读者-写者问题**

- 目标：允许多个读者并发读，但写者独占访问。
    
- 信号量用于协调读者数量与写者访问权限。
    

## 与其他操作系统机制的联系

|概念|说明|
|---|---|
|**互斥锁（Mutex）**|本质上是二进制信号量，但更语义化，常用于线程间互斥|
|**条件变量**|与互斥锁配合，用于复杂线程同步|
|**管程（Monitor）**|高级同步抽象，内部可用信号量实现|
|**死锁**|使用多个信号量时若顺序控制不当，可能导致死锁（需避免环路等待）|
|**进程调度**|阻塞与唤醒操作依赖操作系统调度机制实现信号量行为|

## 常见问题

- **死锁**：不合理使用多个信号量（如顺序不同）易引发。
    
- **饥饿**：信号量策略不当，某进程可能长期得不到资源。
    
- **忙等待**：原始信号量实现可能导致CPU资源浪费，现代实现使用阻塞机制避免。
    

## 小结记忆口诀

> “P 等待抢资源，V 释放唤进程；计数管理多资源，互斥同步两应用。”

需要我为该笔记卡片配一张图示来帮助理解信号量机制吗？